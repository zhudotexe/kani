POST https://api.anthropic.com/v1/messages
accept: application/json
content-type: application/json
x-api-key: *** REDACTED ***

{"max_tokens":2048,"messages":[{"role":"user","content":[{"type":"text","text":"Call the flaky_function with x=42. Retry if it fails, it should eventually work."}]},{"role":"assistant","content":[{"type":"text","text":"I'll call the flaky_function with x=42 and retry if it fails."},{"type":"tool_use","id":"toolu_01FALVGfYTgyLRKeazTxmrR7","name":"flaky_function","input":{"x":42}}]},{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01FALVGfYTgyLRKeazTxmrR7","content":"First call always fails!","is_error":true}]},{"role":"assistant","content":[{"type":"text","text":"As expected, the first call failed. Let me retry:"},{"type":"tool_use","id":"toolu_01J1TvBbjgDyySz2ttF9NKdX","name":"flaky_function","input":{"x":42}}]},{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01J1TvBbjgDyySz2ttF9NKdX","content":"Success! x = 42"}]}],"model":"claude-haiku-4-5","tools":[{"name":"flaky_function","description":"A function that fails the first time.","input_schema":{"description":"A function that fails the first time.","properties":{"x":{"type":"integer"}},"required":["x"],"title":"flaky_function","type":"object"}}]}